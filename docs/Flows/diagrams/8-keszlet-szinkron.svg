<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 -20 1030 920" class="w-full h-auto">
<defs>
<style>.excalidraw-text { font-family: Segoe UI, Arial, sans-serif; }</style>
<marker id="ah" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
<polygon points="0 0, 10 3, 0 6" fill="#1e1e1e"/>
</marker>
</defs>
<rect x="10" y="-20" width="1030" height="920" fill="#ffffff"/>
<text x="700" y="48" font-size="28" fill="#1e1e1e" text-anchor="middle" class="excalidraw-text" opacity="1">KGC ERP - KÃ‰SZLET SZINKRONIZÃCIÃ“</text>
<text x="700" y="79" font-size="14" fill="#868e96" text-anchor="middle" class="excalidraw-text" opacity="1">OrszÃ¡gos kÃ©szlet lÃ¡thatÃ³sÃ¡g - Webshop + Franchise integrÃ¡ciÃ³</text>
<rect x="350" y="100" width="300" height="120" stroke="#7950f2" fill="#f3d9fa" stroke-width="3" rx="0" opacity="1"/>
<rect x="350" y="100" width="300" height="35" stroke="#7950f2" fill="#7950f2" stroke-width="2" rx="0" opacity="1"/>
<text x="500" y="123" font-size="16" fill="#ffffff" text-anchor="middle" class="excalidraw-text" opacity="1">ğŸ¢ KÃ–ZPONTI KÃ‰SZLET NÃ‰ZET</text>
<text x="500" y="156" font-size="11" fill="#7950f2" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ AggregÃ¡lt kÃ©szlet minden boltbÃ³l</text>
<text x="500" y="169.2" font-size="11" fill="#7950f2" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ ValÃ³s idejÅ± frissÃ­tÃ©s</text>
<text x="500" y="182.4" font-size="11" fill="#7950f2" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ Webshop szÃ¡mÃ¡ra egy forrÃ¡s</text>
<text x="500" y="195.6" font-size="11" fill="#7950f2" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ Franchise statisztikÃ¡k</text>
<path d="M 400 220 L 250 280" stroke="#495057" fill="none" stroke-width="2" opacity="1"/>
<path d="M 500 220 L 500 280" stroke="#495057" fill="none" stroke-width="2" opacity="1"/>
<path d="M 600 220 L 750 280" stroke="#495057" fill="none" stroke-width="2" opacity="1"/>
<rect x="100" y="290" width="200" height="100" stroke="#1971c2" fill="#e7f5ff" stroke-width="2" rx="0" opacity="1"/>
<rect x="100" y="290" width="200" height="30" stroke="#1971c2" fill="#1971c2" stroke-width="2" rx="0" opacity="1"/>
<text x="200" y="310" font-size="13" fill="#ffffff" text-anchor="middle" class="excalidraw-text" opacity="1">ğŸª KGC KÃ¶zpont</text>
<text x="200" y="340" font-size="10" fill="#1971c2" text-anchor="middle" class="excalidraw-text" opacity="1">tenant_id: KGC-01</text>
<text x="200" y="352" font-size="10" fill="#1971c2" text-anchor="middle" class="excalidraw-text" opacity="1">KÃ©szlet: SajÃ¡t raktÃ¡r</text>
<text x="200" y="364" font-size="10" fill="#1971c2" text-anchor="middle" class="excalidraw-text" opacity="1">StÃ¡tusz: FÅ‘ bolt</text>
<rect x="400" y="290" width="200" height="100" stroke="#2f9e44" fill="#ebfbee" stroke-width="2" rx="0" opacity="1"/>
<rect x="400" y="290" width="200" height="30" stroke="#2f9e44" fill="#2f9e44" stroke-width="2" rx="0" opacity="1"/>
<text x="500" y="310" font-size="13" fill="#ffffff" text-anchor="middle" class="excalidraw-text" opacity="1">ğŸª Franchise #1</text>
<text x="500" y="340" font-size="10" fill="#2f9e44" text-anchor="middle" class="excalidraw-text" opacity="1">tenant_id: FRAN-01</text>
<text x="500" y="352" font-size="10" fill="#2f9e44" text-anchor="middle" class="excalidraw-text" opacity="1">KÃ©szlet: SajÃ¡t raktÃ¡r</text>
<text x="500" y="364" font-size="10" fill="#2f9e44" text-anchor="middle" class="excalidraw-text" opacity="1">StÃ¡tusz: Partner</text>
<rect x="700" y="290" width="200" height="100" stroke="#e8590c" fill="#fff4e6" stroke-width="2" rx="0" opacity="1"/>
<rect x="700" y="290" width="200" height="30" stroke="#e8590c" fill="#e8590c" stroke-width="2" rx="0" opacity="1"/>
<text x="800" y="310" font-size="13" fill="#ffffff" text-anchor="middle" class="excalidraw-text" opacity="1">ğŸª Franchise #N</text>
<text x="800" y="340" font-size="10" fill="#e8590c" text-anchor="middle" class="excalidraw-text" opacity="1">tenant_id: FRAN-N</text>
<text x="800" y="352" font-size="10" fill="#e8590c" text-anchor="middle" class="excalidraw-text" opacity="1">KÃ©szlet: SajÃ¡t raktÃ¡r</text>
<text x="800" y="364" font-size="10" fill="#e8590c" text-anchor="middle" class="excalidraw-text" opacity="1">StÃ¡tusz: Partner</text>
<rect x="50" y="100" width="200" height="120" stroke="#f783ac" fill="#fff0f6" stroke-width="2" rx="0" opacity="1"/>
<rect x="50" y="100" width="200" height="35" stroke="#f783ac" fill="#f783ac" stroke-width="2" rx="0" opacity="1"/>
<text x="150" y="123" font-size="16" fill="#ffffff" text-anchor="middle" class="excalidraw-text" opacity="1">ğŸŒ WEBSHOP</text>
<text x="150" y="155" font-size="10" fill="#f783ac" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ VevÅ‘ bÃ¶ngÃ©sz gÃ©peket</text>
<text x="150" y="167" font-size="10" fill="#f783ac" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ LÃ¡tja: hol elÃ©rhetÅ‘</text>
<text x="150" y="179" font-size="10" fill="#f783ac" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ FoglalÃ¡s/rendelÃ©s</text>
<text x="150" y="191" font-size="10" fill="#f783ac" text-anchor="middle" class="excalidraw-text" opacity="1">â€¢ ÃtvÃ©teli hely vÃ¡lasztÃ¡s</text>
<path d="M 250 160 L 350 160" stroke="#f783ac" fill="none" stroke-width="2" opacity="1"/>
<text x="270" y="155" font-size="10" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1">API</text>
<rect x="750" y="100" width="200" height="120" stroke="#fab005" fill="#fff9db" stroke-width="2" rx="0" opacity="1"/>
<rect x="750" y="100" width="200" height="35" stroke="#fab005" fill="#fab005" stroke-width="2" rx="0" opacity="1"/>
<text x="850" y="123" font-size="16" fill="#ffffff" text-anchor="middle" class="excalidraw-text" opacity="1">ğŸ‘¤ VEVÅ LÃTJA</text>
<text x="850" y="155" font-size="10" fill="#fab005" text-anchor="middle" class="excalidraw-text" opacity="1">&quot;Makita fÃºrÃ³gÃ©p&quot;</text>
<text x="850" y="167" font-size="10" fill="#fab005" text-anchor="middle" class="excalidraw-text" opacity="1">âœ… KGC KÃ¶zpont: 3 db</text>
<text x="850" y="179" font-size="10" fill="#fab005" text-anchor="middle" class="excalidraw-text" opacity="1">âœ… Franchise #1: 1 db</text>
<text x="850" y="191" font-size="10" fill="#fab005" text-anchor="middle" class="excalidraw-text" opacity="1">âŒ Franchise #2: 0 db</text>
<path d="M 650 160 L 750 160" stroke="#fab005" fill="none" stroke-width="2" opacity="1"/>
<rect x="50" y="420" width="450" height="220" stroke="#1971c2" fill="#e7f5ff" stroke-width="2" rx="0" opacity="1"/>
<rect x="50" y="420" width="450" height="30" stroke="#1971c2" fill="#1971c2" stroke-width="2" rx="0" opacity="1"/>
<text x="60" y="441" font-size="14" fill="#ffffff" text-anchor="start" class="excalidraw-text" opacity="1">ğŸ“Š KÃ‰SZLET_AGGREGÃLT NÃ©zet (View)</text>
<text x="60" y="470" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">CREATE VIEW keszlet_aggregalt AS</text>
<text x="60" y="482" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">SELECT</text>
<text x="60" y="494" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    c.cikk_id,</text>
<text x="60" y="506" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    c.nev AS cikk_nev,</text>
<text x="60" y="518" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    c.cikkszam,</text>
<text x="60" y="530" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    t.tenant_id,</text>
<text x="60" y="542" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    t.nev AS bolt_nev,</text>
<text x="60" y="554" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    t.varos,</text>
<text x="60" y="566" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    COALESCE(k.mennyiseg, 0) AS keszlet,</text>
<text x="60" y="578" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    COALESCE(k.foglalt, 0) AS foglalt,</text>
<text x="60" y="590" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">    COALESCE(k.mennyiseg, 0) - COALESCE(k.foglalt, 0) AS elerheto</text>
<text x="60" y="602" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">FROM cikk c</text>
<text x="60" y="614" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">CROSS JOIN tenant t</text>
<text x="60" y="626" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">LEFT JOIN keszlet k ON k.cikk_id = c.cikk_id AND k.tenant_id = t.tenant_id</text>
<text x="60" y="638" font-size="10" fill="#1971c2" text-anchor="start" class="excalidraw-text" opacity="1">WHERE t.aktiv = true AND t.keszlet_publikus = true;</text>
<rect x="520" y="420" width="430" height="220" stroke="#2f9e44" fill="#ebfbee" stroke-width="2" rx="0" opacity="1"/>
<rect x="520" y="420" width="430" height="30" stroke="#2f9e44" fill="#2f9e44" stroke-width="2" rx="0" opacity="1"/>
<text x="530" y="441" font-size="14" fill="#ffffff" text-anchor="start" class="excalidraw-text" opacity="1">ğŸ”„ SZINKRONIZÃCIÃ“S FOLYAMAT</text>
<text x="530" y="470" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">1. VÃLTOZÃS DETEKTÃLÃS</text>
<text x="530" y="482" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">   â””â”€ KÃ©szlet mozgÃ¡s trigger (bevÃ©telezÃ©s, eladÃ¡s, bÃ©rlÃ©s)</text>
<text x="530" y="494" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1"></text>
<text x="530" y="506" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">2. KÃ–ZPONTI FRISSÃTÃ‰S</text>
<text x="530" y="518" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">   â””â”€ Tenant kÃ©szlet â†’ KÃ¶zponti aggregÃ¡ciÃ³</text>
<text x="530" y="530" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">   â””â”€ Event-driven (nem polling!)</text>
<text x="530" y="542" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1"></text>
<text x="530" y="554" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">3. WEBSHOP CACHE INVALIDÃCIÃ“</text>
<text x="530" y="566" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">   â””â”€ Redis pub/sub Ã©rtesÃ­tÃ©s</text>
<text x="530" y="578" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">   â””â”€ CDN cache tÃ¶rlÃ©s az Ã©rintett cikkeknÃ©l</text>
<text x="530" y="590" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1"></text>
<text x="530" y="602" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">4. VALÃ“S IDEJÅ° MEGJELENÃTÃ‰S</text>
<text x="530" y="614" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">   â””â”€ WebSocket push a bÃ¶ngÃ©szÅ‘knek</text>
<text x="530" y="626" font-size="10" fill="#2f9e44" text-anchor="start" class="excalidraw-text" opacity="1">   â””â”€ &quot;KÃ©szlet frissÃ¼lt&quot; animÃ¡ciÃ³</text>
<rect x="50" y="660" width="900" height="100" stroke="#f783ac" fill="#fff0f6" stroke-width="2" rx="0" opacity="1"/>
<text x="60" y="684" font-size="14" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1">ğŸŒ WEBSHOP API ENDPOINT</text>
<text x="60" y="705" font-size="10" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1">GET /api/v1/products/{cikkszam}/availability</text>
<text x="60" y="717" font-size="10" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1"></text>
<text x="60" y="729" font-size="10" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1">Response: { &quot;cikkszam&quot;: &quot;MAK-DHP453&quot;, &quot;nev&quot;: &quot;Makita akkus fÃºrÃ³&quot;, &quot;locations&quot;: [</text>
<text x="60" y="741" font-size="10" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1">    { &quot;bolt&quot;: &quot;KGC KÃ¶zpont&quot;, &quot;varos&quot;: &quot;Budapest&quot;, &quot;elerheto&quot;: 3, &quot;cim&quot;: &quot;FÅ‘ u. 1.&quot; },</text>
<text x="60" y="753" font-size="10" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1">    { &quot;bolt&quot;: &quot;Franchise Szeged&quot;, &quot;varos&quot;: &quot;Szeged&quot;, &quot;elerheto&quot;: 1, &quot;cim&quot;: &quot;Kossuth tÃ©r 5.&quot; }</text>
<text x="60" y="765" font-size="10" fill="#f783ac" text-anchor="start" class="excalidraw-text" opacity="1">]}</text>
<rect x="50" y="780" width="900" height="80" stroke="#e03131" fill="#ffe3e3" stroke-width="2" rx="0" opacity="1"/>
<text x="60" y="804" font-size="14" fill="#e03131" text-anchor="start" class="excalidraw-text" opacity="1">ğŸ”’ ADATVÃ‰DELMI SZABÃLYOK</text>
<text x="60" y="825" font-size="10" fill="#e03131" text-anchor="start" class="excalidraw-text" opacity="1">â€¢ Franchise partner dÃ¶nthet: megosztja-e kÃ©szletÃ©t a webshopban (keszlet_publikus flag)</text>
<text x="60" y="837" font-size="10" fill="#e03131" text-anchor="start" class="excalidraw-text" opacity="1">â€¢ KÃ¶zpont lÃ¡tja az Ã¶sszes kÃ©szletet (statisztikÃ¡hoz), de franchise pÃ©nzÃ¼gyÃ©t NEM</text>
<text x="60" y="849" font-size="10" fill="#e03131" text-anchor="start" class="excalidraw-text" opacity="1">â€¢ VevÅ‘ csak az elÃ©rhetÅ‘ mennyisÃ©get lÃ¡tja, Ã¡rat nem (az bolt-specifikus lehet)</text>
</svg>