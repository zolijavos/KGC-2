# KGC ERP v2 - Fit-Gap Anal√≠zis

**K√©sz√≠tette:** Mary (Business Analyst) + BMAD Team
**D√°tum:** 2025-12-07
**Forr√°s:** kgc-notes-1765134941556.csv
**Referencia:** /docs/Flows/diagram-docs/ (30 dokumentum)
**Verzi√≥:** 2.0

---

## Executive Summary

Ez a dokumentum a 2025-12-07-i megbesz√©l√©s sor√°n r√∂gz√≠tett √∫j k√∂vetelm√©nyeket elemzi, √©s √∂sszeveti a jelenlegi **dokument√°lt folyamatokkal** a `/docs/Flows/diagram-docs/` mapp√°ban tal√°lhat√≥ 30 diagram dokument√°ci√≥ alapj√°n.

### √ñsszefoglal√≥ Metrik√°k

| Kateg√≥ria | Darab | Ar√°ny |
|-----------|-------|-------|
| **FIT** (Megl√©v≈ë, megfelel≈ë) | 8 | 32% |
| **PARTIAL** (R√©szben lefedett) | 7 | 28% |
| **GAP** (Hi√°nyzik) | 10 | 40% |
| **√ñsszesen** | 25 | 100% |

### Priorit√°s Szerinti Bont√°s

| Priorit√°s | GAP-ek | Becs√ºlt Effort |
|-----------|--------|----------------|
| üî¥ Kritikus | 3 | 5-8 story |
| üü† Magas | 4 | 6-10 story |
| üü° K√∂zepes | 3 | 4-6 story |

---

## 1. √úgyf√©l Felv√©tel √©s B√©rl√©s

**Referencia dokumentumok:**
- [01-ugyfelfelvitel-folyamat.md](../diagram-docs/01-ugyfelfelvitel-folyamat.md)
- [01-ugyfelfelvitel-erd.md](../diagram-docs/01-ugyfelfelvitel-erd.md)
- [01-ugyfelfelvitel-dontesi-fa.md](../diagram-docs/01-ugyfelfelvitel-dontesi-fa.md)
- [06-egyeb-felhasznalo.md](../diagram-docs/06-egyeb-felhasznalo.md)

### 1.1 Bel√©p√©si Jogosults√°gok

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 1.1.1 | Alap bel√©p√©si szint bolti g√©pekre (3 db) | üî¥ **GAP** | **06-egyeb-felhasznalo.md**: RBAC 6 szerepk√∂r van (SUPER_ADMIN ‚Üí VIEWER), de felhaszn√°l√≥-alap√∫, nem g√©p-specifikus | √öj: DEVICE_REGISTRATION entit√°s + KIOSK_MODE szerepk√∂r |
| 1.1.2 | Bev√©telez≈ë g√©pn√©l m√°s jogosults√°gi szint | üü° **PARTIAL** | RBAC m√°trix l√©tezik, de minden felhaszn√°l√≥hoz k√∂t√∂tt | B≈ëv√≠t√©s: device_type mez≈ë + device-based policy |
| 1.1.3 | Szervizesek egy√©ni ind√≠t√°sa | ‚úÖ **FIT** | RBAC + egy√©ni bejelentkez√©s dokument√°lva | Megoldott |

**Dokument√°lt RBAC szintek (06-egyeb-felhasznalo.md:77-112):**
```
Szint 1: SUPER_ADMIN    - Teljes rendszer hozz√°f√©r√©s
Szint 2: TENANT_ADMIN   - Franchise partner admin
Szint 3: BRANCH_MANAGER - Telephely vezet≈ë
Szint 4: SENIOR_OPERATOR- Tapasztalt kezel≈ë
Szint 5: OPERATOR       - Norm√°l kezel≈ë
Szint 6: VIEWER         - Csak olvas√°s
```

**Architect Javaslat:**
```sql
CREATE TABLE DEVICE_REGISTRATION (
    device_id UUID PRIMARY KEY,
    device_type VARCHAR(20) CHECK (device_type IN ('kiosk', 'backoffice', 'service')),
    default_role_id INT REFERENCES roles(role_id),
    tenant_id UUID REFERENCES tenants(tenant_id),
    location VARCHAR(100),
    device_name VARCHAR(50),
    is_active BOOLEAN DEFAULT true
);
```

---

### 1.2 B√©rleti Szerz≈ëd√©s

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 1.2.1 | Szerz≈ëd√©s mindig mag√°nszem√©lyre, sz√°mla lehet c√©gn√©vre | ‚úÖ **FIT** | **01-ugyfelfelvitel-folyamat.md:76-78**: "A szerz≈ëd√©s MINDIG a mag√°nszem√©llyel k√∂ttetik! A c√©g csak a sz√°mla c√≠mzettje lehet." | Megoldott |
| 1.2.2 | C√©g duplik√°ci√≥ figyelmeztet√©s | üü° **PARTIAL** | **01-ugyfelfelvitel-erd.md:93-94**: NAV ellen≈ërz√©s (nav_ellenorzott mez≈ë), de csak manu√°lis keres√©s | B≈ëv√≠t√©s: automatikus fuzzy match + alert |
| 1.2.3 | √Åtutal√°sn√°l csak c√©g √°ltal enged√©lyezett szem√©lyek | üî¥ **GAP** | **01-ugyfelfelvitel-dontesi-fa.md:197-199**: Fizet√©si m√≥dok dokument√°lva (KP/K√°rtya/√Åtutal√°s), de nincs szem√©ly-szint≈± jogosults√°g | √öj: C√âG_MEGHATALMAZOTT entit√°s |
| 1.2.4 | Dolgoz√≥i kedvezm√©ny (b√©rl√©s + v√°s√°rl√°s) | üî¥ **GAP** | **01-ugyfelfelvitel-erd.md**: Nincs is_employee mez≈ë vagy kedvezm√©ny rendszer | √öj: KEDVEZM√âNY_T√çPUS + partner.is_employee flag |

**Dokument√°lt C√âG entit√°s (01-ugyfelfelvitel-erd.md:72-84):**
```
C√âG
‚îú‚îÄ‚îÄ ceg_id (PK)
‚îú‚îÄ‚îÄ tenant_id (UUID)
‚îú‚îÄ‚îÄ partner_id (FK) ‚Üí PARTNER
‚îú‚îÄ‚îÄ cegnev (VARCHAR)
‚îú‚îÄ‚îÄ adoszam (VARCHAR)
‚îú‚îÄ‚îÄ cim (VARCHAR)
‚îú‚îÄ‚îÄ mukodo (BOOLEAN)
‚îî‚îÄ‚îÄ nav_ellenorzott (DATETIME)
```

**Hi√°nyz√≥ mez≈ëk:**
```sql
ALTER TABLE CEG ADD COLUMN vat_zone VARCHAR(10) CHECK (vat_zone IN ('HU', 'EU', 'NON_EU'));
-- K√ºl√∂n t√°bla a meghatalmazottakhoz:
CREATE TABLE CEG_MEGHATALMAZOTT (
    meghatalmazott_id SERIAL PRIMARY KEY,
    ceg_id INT REFERENCES ceg(ceg_id),
    partner_id INT REFERENCES partner(partner_id),
    ervenyesseg_kezdete DATE,
    ervenyesseg_vege DATE,
    dokumentum_url VARCHAR(500)
);
```

---

### 1.3 Kauci√≥ Kezel√©s (MyPos)

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 1.3.1 | K√°rty√°s kauci√≥ + 2% k√©nyelmi d√≠j | üî¥ **GAP** | **01-ugyfelfelvitel-folyamat.md:111-117**: "CSAK K√âSZP√âNZ fogadhat√≥!" + **01-ugyfelfelvitel-dontesi-fa.md:201-211**: "A kauci√≥ CSAK K√âSZP√âNZBEN fogadhat√≥ el!" | √öj: KAUCI√ì_T√çPUS + MyPos integr√°ci√≥ |
| 1.3.2 | Visszafizet√©s ugyanarra a k√°rty√°ra | üî¥ **GAP** | Nincs k√°rtya token t√°rol√°s dokument√°lva | √öj: payment_token mez≈ë + MyPos refund API |
| 1.3.3 | 2%-kal cs√∂kkentett visszafizet√©s | üü° **PARTIAL** | **01-ugyfelfelvitel-erd.md:122**: kaucio (DECIMAL) mez≈ë l√©tezik | B≈ëv√≠t√©s: kauci√≥_t√≠pus alap√∫ kalkul√°ci√≥ |

**Jelenlegi dokument√°lt kauci√≥ folyamat (01-ugyfelfelvitel-folyamat.md:107-117):**
```
Kauci√≥ R√∂gz√≠t√©se:
‚Ä¢ Kauci√≥ √∂sszeg r√∂gz√≠t√©se
‚Ä¢ CSAK K√âSZP√âNZ fogadhat√≥!
‚Ä¢ Megjegyz√©s mez≈ë kit√∂lt√©se (opcion√°lis)
```

**√öj kauci√≥ t√≠pusok √©s sz√°m√≠t√°s:**
```sql
ALTER TABLE BERLES ADD COLUMN kaucio_tipus VARCHAR(10)
    CHECK (kaucio_tipus IN ('cash', 'transfer', 'card'));
ALTER TABLE BERLES ADD COLUMN payment_token VARCHAR(100);
ALTER TABLE BERLES ADD COLUMN kaucio_visszafizetes DECIMAL(10,2);

-- Kalkul√°ci√≥ k√°rty√°s fizet√©sn√©l:
-- kaucio_visszafizetes = kaucio * 0.98 (2% levonva)
```

**P√©nz√ºgyi K√©rd√©s:** √ÅFA tartalom a 2% d√≠jn√°l? ‚Üí K√∂nyvel≈ëi egyeztet√©s sz√ºks√©ges!

---

### 1.4 G√©p Kiad√°s/Visszav√©tel

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 1.4.1 | Kell√©kek √©s tartoz√©kok pip√°l√°sa | üü° **PARTIAL** | **01-ugyfelfelvitel-erd.md:123**: Van megjegyzes (TEXT) mez≈ë | B≈ëv√≠t√©s: B√âRL√âS_TARTOZ√âK join t√°bla struktur√°lt adatokkal |
| 1.4.2 | Ki adta ki / ki vette vissza (szem√©ly) | üî¥ **GAP** | **01-ugyfelfelvitel-erd.md:116-117**: Van rogzito_id √©s visszavevo_id, DE ez a RENDSZERBEN bejelentkezett user, NEM a fizikailag kiad√≥/visszavev≈ë szem√©ly | √öj: kiadta_user_id, visszavette_user_id mez≈ëk fizikai szem√©lyhez |
| 1.4.3 | K√©s≈ëbb fizetend≈ë t√©telek (vonalk√≥d) | üü° **PARTIAL** | **01-ugyfelfelvitel-dontesi-fa.md:152-162**: "0" id≈ëtartam = sz√°ll√≠t√≥lev√©l dokument√°lva | B≈ëv√≠t√©s: pending_items t√°bla + vonalk√≥dos k√∂vet√©s |
| 1.4.4 | Sz√°ll√≠t√≥lev√©l mint mell√©klet | ‚úÖ **FIT** | **08-keszlet-szinkron.md**: Dokumentum csatol√°s tervezett | Megoldott |

**Dokument√°lt B√âRL√âS entit√°s (01-ugyfelfelvitel-erd.md:106-127):**
```
B√âRL√âS
‚îú‚îÄ‚îÄ berles_id (PK)
‚îú‚îÄ‚îÄ tenant_id (UUID)
‚îú‚îÄ‚îÄ partner_id (FK) ‚Üí PARTNER
‚îú‚îÄ‚îÄ ceg_id (FK) ‚Üí C√âG [nullable]
‚îú‚îÄ‚îÄ cikk_id (FK) ‚Üí CIKK
‚îú‚îÄ‚îÄ rogzito_id (FK) ‚Üí FELHASZN√ÅL√ì   ‚Üê Rendszerben bejelentkezett
‚îú‚îÄ‚îÄ visszavevo_id (FK) ‚Üí FELHASZN√ÅL√ì ‚Üê Rendszerben bejelentkezett
‚îú‚îÄ‚îÄ kezdes (DATETIME)
‚îú‚îÄ‚îÄ vart_befejezes (DATETIME)
‚îú‚îÄ‚îÄ befejezes (DATETIME)
‚îú‚îÄ‚îÄ idotartam (ENUM)
‚îú‚îÄ‚îÄ kaucio (DECIMAL)
‚îú‚îÄ‚îÄ megjegyzes (TEXT)
‚îú‚îÄ‚îÄ statusz (ENUM)
‚îî‚îÄ‚îÄ offline_sync (BOOLEAN)
```

**Hi√°nyz√≥ mez≈ëk a fizikai √°tad√°shoz:**
```sql
ALTER TABLE BERLES ADD COLUMN kiadta_fizikai_user_id INT REFERENCES felhasznalo(felhasznalo_id);
ALTER TABLE BERLES ADD COLUMN visszavette_fizikai_user_id INT REFERENCES felhasznalo(felhasznalo_id);

-- Tartoz√©kok struktur√°lt t√°rol√°sa:
CREATE TABLE BERLES_TARTOZEK (
    tartozek_id SERIAL PRIMARY KEY,
    berles_id INT REFERENCES berles(berles_id),
    tartozek_nev VARCHAR(100),
    kiadva BOOLEAN DEFAULT false,
    visszahozva BOOLEAN DEFAULT false,
    megjegyzes VARCHAR(500)
);
```

---

## 2. D√∂nt√©si Fa B≈ëv√≠t√©sek

**Referencia dokumentum:** [01-ugyfelfelvitel-dontesi-fa.md](../diagram-docs/01-ugyfelfelvitel-dontesi-fa.md)

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 2.1 | K√©szp√©nz + nem sz√°mla ‚Üí h√°tt√©r sz√°ll√≠t√≥lev√©l | üü° **PARTIAL** | **01-ugyfelfelvitel-dontesi-fa.md:197**: K√°rtya = nincs sz√°mla dokument√°lva | B≈ëv√≠t√©s: automatikus h√°tt√©r sz√°ll√≠t√≥lev√©l gener√°l√°s |
| 2.2 | K√°r eset√©n jegyz≈ëk√∂nyv a benntartott kauci√≥r√≥l | üî¥ **GAP** | Nincs formaliz√°lt jegyz≈ëk√∂nyv folyamat | √öj: KAUCI√ì_JEGYZ≈êK√ñNYV entit√°s + sablon |

**Dokument√°lt fizet√©si m√≥dok (01-ugyfelfelvitel-dontesi-fa.md:192-198):**
```
| M√≥d       | Sz√°mla              | Megjegyz√©s            |
|-----------|---------------------|-----------------------|
| K√©szp√©nz  | Automatikus nyugta  | Leggyakoribb          |
| K√°rtya    | Nincs rendszer sz.  | Termin√°l bizonylat    |
| √Åtutal√°s  | Sz√°mla k√∂telez≈ë     | C√©ges √ºgyfelekn√©l     |
```

**√öj entit√°s:**
```sql
CREATE TABLE KAUCIO_JEGYZOKONYV (
    jegyzokonyv_id SERIAL PRIMARY KEY,
    berles_id INT REFERENCES berles(berles_id),
    kar_leiras TEXT,
    becsult_koltseg DECIMAL(10,2),
    benntartott_kaucio DECIMAL(10,2),
    fotok_url VARCHAR(500)[],
    kesz_datum DATETIME,
    keszitette_user_id INT REFERENCES felhasznalo(felhasznalo_id),
    partner_alairas BOOLEAN DEFAULT false,
    tenant_id UUID
);
```

---

## 3. Partner/C√©g Adatmodell

**Referencia dokumentum:** [01-ugyfelfelvitel-erd.md](../diagram-docs/01-ugyfelfelvitel-erd.md)

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 3.1 | TAJ sz√°m NEM kell | ‚úÖ **FIT** | **01-ugyfelfelvitel-erd.md:37**: taj_szam (VARCHAR) opcion√°lis | T√∂r√∂lhet≈ë, de nem blokkol√≥ |
| 3.2 | Anyja neve, sz√ºlet√©si hely/id≈ë | üü° **PARTIAL** | Nincs a dokument√°lt entit√°sban | B≈ëv√≠t√©s: mothers_name, birth_place mez≈ëk |
| 3.3 | Tart√≥zkod√°si hely (ha k√ºl√∂nb√∂zik) | üî¥ **GAP** | **01-ugyfelfelvitel-erd.md:35**: Csak egy cim mez≈ë | √öj: ADDRESS t√≠pus b≈ëv√≠t√©s (permanent, temporary) |
| 3.4 | C√©g √ÅFA t√≠pus automatikus (HU/EU/3.orsz√°g) | üü° **PARTIAL** | Nincs vat_zone mez≈ë dokument√°lva | B≈ëv√≠t√©s: vat_zone enum + ad√≥sz√°m alap√∫ auto-detect |

**Dokument√°lt PARTNER entit√°s (01-ugyfelfelvitel-erd.md:27-44):**
```
PARTNER
‚îú‚îÄ‚îÄ partner_id (PK)
‚îú‚îÄ‚îÄ tenant_id (UUID)
‚îú‚îÄ‚îÄ nev (VARCHAR) - k√∂telez≈ë
‚îú‚îÄ‚îÄ cim (VARCHAR) - k√∂telez≈ë
‚îú‚îÄ‚îÄ igazolvanyszam (VARCHAR) - k√∂telez≈ë
‚îú‚îÄ‚îÄ taj_szam (VARCHAR) - opcion√°lis
‚îú‚îÄ‚îÄ telefon (VARCHAR)
‚îú‚îÄ‚îÄ email (VARCHAR)
‚îú‚îÄ‚îÄ e_szamla (BOOLEAN)
‚îú‚îÄ‚îÄ rogzito_id (FK)
‚îú‚îÄ‚îÄ rogzites_datum (DATETIME)
‚îî‚îÄ‚îÄ tipus (ENUM: magan/ceg)
```

**Hi√°nyz√≥ mez≈ëk:**
```sql
ALTER TABLE PARTNER ADD COLUMN mothers_name VARCHAR(100);
ALTER TABLE PARTNER ADD COLUMN birth_place VARCHAR(100);
ALTER TABLE PARTNER ADD COLUMN birth_date DATE;
ALTER TABLE PARTNER ADD COLUMN is_employee BOOLEAN DEFAULT false;
ALTER TABLE PARTNER ADD COLUMN temporary_address VARCHAR(300);
ALTER TABLE PARTNER ADD COLUMN address_type VARCHAR(20) CHECK (address_type IN ('permanent', 'temporary', 'both'));
```

---

## 4. √ârt√©kes√≠t√©s/K√©szlet

**Referencia dokumentum:** [02-ertekesites-erd.md](../diagram-docs/02-ertekesites-erd.md)

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 4.1 | Cikkcsoportok jelent≈ës√©ge cs√∂kkent | ‚úÖ **FIT** | **02-ertekesites-erd.md:36**: cikkcsoport_id (FK) opcion√°lis | Nincs teend≈ë |
| 4.2 | Vonalk√≥dos digit√°lis lelt√°r | ‚úÖ **FIT** | **02-ertekesites-erd.md:40**: vonalkod mez≈ë + ADR-002 PWA | Megoldott |
| 4.3 | Kiindul√≥ k√©szlet: lelt√°r + 5 √©vn√©l nem r√©gebbi | ‚úÖ **FIT** | Migr√°ci√≥ terv r√©sze | Megoldott |

---

## 5. B√©rg√©p Kezel√©s

**Referencia dokumentum:** [03-bergep-folyamat.md](../diagram-docs/03-bergep-folyamat.md)

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 5.1 | B√©rleti d√≠j / 24 √≥ra mez≈ë | üü° **PARTIAL** | **03-bergep-folyamat.md**: Van napi_dij mez≈ë a CIKK entit√°sban | B≈ëv√≠t√©s: pricing_unit enum (hour, day, weekend) |
| 5.2 | Kapcsol√≥d√≥ term√©kek (v√©s≈ësz√°r, akku) | üî¥ **GAP** | Nincs kapcsolat dokument√°lva | √öj: B√âRG√âP_TARTOZ√âK join t√°bla |
| 5.3 | Gyakori jav√≠t√°si cikksz√°mok | üî¥ **GAP** | Nincs ilyen lista | √öj: B√âRG√âP_JAV√çT√ÅS_CIKK join t√°bla |
| 5.4 | H√©tv√©ge opci√≥ (1,5 nap sz√°m√≠t√°s) | üî¥ **GAP** | **01-ugyfelfelvitel-erd.md:130-135**: Csak felnap/1nap enum | √öj: weekend_pricing logika + auto-sz√°m√≠t√°s |

**Dokument√°lt B√©rg√©p √°llapotok (03-bergep-folyamat.md:169-203):**
```
üü¢ EL√âRHET≈ê (bent) - B√©rl√©sre kiadhat√≥
‚ö™ KIADVA (kint)   - Akt√≠v b√©rl√©s alatt
üîµ SZERVIZ         - Jav√≠t√°s alatt, nem kiadhat√≥
```

**Hi√°nyz√≥ b√©rg√©p funkci√≥k:**
```sql
-- B√©rg√©p √°raz√°si egys√©g:
ALTER TABLE CIKK ADD COLUMN pricing_unit VARCHAR(10)
    CHECK (pricing_unit IN ('hour', 'day', 'weekend'));

-- H√©tv√©ge sz√°m√≠t√°s: szombat-h√©tf≈ë = 1.5 nap d√≠j
ALTER TABLE CIKK ADD COLUMN weekend_multiplier DECIMAL(3,2) DEFAULT 1.5;

-- Kapcsol√≥d√≥ term√©kek:
CREATE TABLE BERGEP_TARTOZEK (
    kapcsolat_id SERIAL PRIMARY KEY,
    bergep_cikk_id INT REFERENCES cikk(cikk_id),
    tartozek_cikk_id INT REFERENCES cikk(cikk_id),
    kotelezo BOOLEAN DEFAULT false,
    megjegyzes VARCHAR(200)
);

-- Gyakori jav√≠t√°si alkatr√©szek:
CREATE TABLE BERGEP_JAVITAS_CIKK (
    kapcsolat_id SERIAL PRIMARY KEY,
    bergep_cikk_id INT REFERENCES cikk(cikk_id),
    alkatresz_cikk_id INT REFERENCES cikk(cikk_id),
    gyakori_hiba VARCHAR(200),
    prioritas INT DEFAULT 0
);
```

---

## 6. Szerviz Folyamat

**Referencia dokumentumok:**
- [04-szerviz-folyamat.md](../diagram-docs/04-szerviz-folyamat.md)
- [04-szerviz-erd.md](../diagram-docs/04-szerviz-erd.md)
- [04-szerviz-munkalap.md](../diagram-docs/04-szerviz-munkalap.md)

| # | √öj K√∂vetelm√©ny | St√°tusz | Dokument√°lt √Ållapot | Gap Le√≠r√°s |
|---|----------------|---------|---------------------|------------|
| 6.1 | 3 felv√©teli st√°tusz (garanci√°lis/jav√≠t√°s/√°raj√°nlat) | ‚úÖ **FIT** | **04-szerviz-erd.md:78-84**: Van st√°tusz kezel√©s, de m√°s √©rt√©kekkel | Enum b≈ëv√≠t√©s: intake_type mez≈ë |
| 6.2 | F√°jlok csatol√°sa (garancialev√©l, sz√°mla, fot√≥) | üü° **PARTIAL** | Nincs attachment t√°bla dokument√°lva | B≈ëv√≠t√©s: t√≠pusos attachment-ek |
| 6.3 | Tartoz√©k checklist (markolat, l√°nc, stb.) | üî¥ **GAP** | **04-szerviz-erd.md:65-70**: Csak problema_leiras (TEXT) | √öj: SZERVIZ_TARTOZ√âK checklist t√°bla |
| 6.4 | Bels≈ë √ºzenetek/megjegyz√©sek | ‚úÖ **FIT** | L√©tezik megjegyzes mez≈ë | B≈ëv√≠t√©s: internal_notes + visibility flag |

**Dokument√°lt MUNKALAP st√°tuszok (04-szerviz-erd.md:78-84):**
```
| K√≥d              | Jelent√©s        |
|------------------|-----------------|
| felveve          | G√©p be√©rkezett  |
| arajanalt        | √Åraj√°nlat k√©sz√ºlt|
| javitas_alatt    | Munka folyamatban|
| szamlazhat√≥      | Jav√≠t√°s k√©sz    |
```

**√öj k√∂vetelm√©ny: 3 felv√©teli t√≠pus (garanci√°lis/jav√≠t√°s/√°raj√°nlat):**
```sql
ALTER TABLE MUNKALAP ADD COLUMN intake_type VARCHAR(20)
    CHECK (intake_type IN ('warranty', 'repair', 'quote'));
ALTER TABLE MUNKALAP ADD COLUMN internal_notes TEXT;
ALTER TABLE MUNKALAP ADD COLUMN internal_notes_visible BOOLEAN DEFAULT false;

-- Tartoz√©k checklist:
CREATE TABLE SZERVIZ_TARTOZEK (
    tartozek_id SERIAL PRIMARY KEY,
    munkalap_id VARCHAR(20) REFERENCES munkalap(munkalap_szam),
    tartozek_tipus VARCHAR(50), -- markolat, l√°nc, l√°ncvezet≈ë, burkolat, akku
    beadva BOOLEAN DEFAULT false,
    allapot VARCHAR(100),
    megjegyzes VARCHAR(200)
);

-- Csatolt dokumentumok:
CREATE TABLE MUNKALAP_CSATOLMANY (
    csatolmany_id SERIAL PRIMARY KEY,
    munkalap_id VARCHAR(20) REFERENCES munkalap(munkalap_szam),
    tipus VARCHAR(30), -- garancialevel, szamla, foto, egyeb
    fajl_url VARCHAR(500),
    fajl_nev VARCHAR(200),
    feltoltve DATETIME,
    feltoltotte_user_id INT REFERENCES felhasznalo(felhasznalo_id)
);
```

---

## √ñsszefoglal√≥: √öj Entit√°sok √©s M√≥dos√≠t√°sok

### √öj Entit√°sok (GAP ‚Üí CREATE)

| # | Entit√°s | Modul | Le√≠r√°s | Priorit√°s |
|---|---------|-------|--------|-----------|
| 1 | DEVICE_REGISTRATION | Auth | G√©p-alap√∫ jogosults√°g kezel√©s | üü° |
| 2 | C√âG_MEGHATALMAZOTT | Partner | √Åtutal√°sra jogosult szem√©lyek | üî¥ |
| 3 | KEDVEZM√âNY_T√çPUS | P√©nz√ºgy | Dolgoz√≥i/VIP kedvezm√©nyek | üü† |
| 4 | KAUCI√ì_JEGYZ≈êK√ñNYV | B√©rl√©s | Benntartott kauci√≥ dokument√°ci√≥ | üü† |
| 5 | B√âRG√âP_TARTOZ√âK | B√©rg√©p | Kapcsol√≥d√≥ term√©kek | üü° |
| 6 | B√âRG√âP_JAV√çT√ÅS_CIKK | B√©rg√©p | Gyakori jav√≠t√°si alkatr√©szek | üü° |
| 7 | SZERVIZ_TARTOZ√âK | Szerviz | Beadott g√©p tartoz√©k checklist | üü† |
| 8 | B√âRL√âS_TARTOZ√âK | B√©rl√©s | B√©rl√©skor kiadott kell√©kek | üü° |
| 9 | MUNKALAP_CSATOLM√ÅNY | Szerviz | Dokumentum attachment-ek | üü° |

### Megl√©v≈ë Entit√°sok B≈ëv√≠t√©se (PARTIAL ‚Üí EXTEND)

```
PARTNER (01-ugyfelfelvitel-erd.md):
  + mothers_name: VARCHAR(100)
  + birth_place: VARCHAR(100)
  + birth_date: DATE
  + temporary_address: VARCHAR(300)
  + address_type: ENUM('permanent', 'temporary', 'both')
  + is_employee: BOOLEAN DEFAULT false
  - taj_szam: T√∂r√∂lhet≈ë (nem k√∂telez≈ë)

C√âG (01-ugyfelfelvitel-erd.md):
  + vat_zone: ENUM('HU', 'EU', 'NON_EU')
  + authorized_persons: FK[] ‚Üí C√âG_MEGHATALMAZOTT

B√âRL√âS (01-ugyfelfelvitel-erd.md):
  + kiadta_fizikai_user_id: FK ‚Üí felhasznalo
  + visszavette_fizikai_user_id: FK ‚Üí felhasznalo
  + kaucio_tipus: ENUM('cash', 'transfer', 'card')
  + payment_token: VARCHAR(100) -- MyPos token
  + kaucio_visszafizetes: DECIMAL(10,2)

CIKK/B√âRG√âP (03-bergep-folyamat.md):
  + pricing_unit: ENUM('hour', 'day', 'weekend')
  + weekend_multiplier: DECIMAL(3,2) DEFAULT 1.5

MUNKALAP (04-szerviz-erd.md):
  + intake_type: ENUM('warranty', 'repair', 'quote')
  + internal_notes: TEXT
  + internal_notes_visible: BOOLEAN
```

---

## Priorit√°s √©s √útemez√©s Javaslat

### üî¥ Sprint 1 - Kritikus (√úzleti kock√°zat)

| # | K√∂vetelm√©ny | Referencia | Story Points | Indokl√°s |
|---|-------------|------------|--------------|----------|
| 1.2.3 | √Åtutal√°s jogosults√°g | 01-ugyfelfelvitel-dontesi-fa.md | 5 | P√©nz√ºgyi kock√°zat cs√∂kkent√©s |
| 1.3.1-2 | MyPos kauci√≥ integr√°ci√≥ | 01-ugyfelfelvitel-folyamat.md | 8 | √úzleti ig√©ny (szerz≈ëd√©s m√°r van) |
| 1.4.2 | Fizikai kiad√≥/visszavev≈ë | 01-ugyfelfelvitel-erd.md | 3 | Felel≈ëss√©g k√∂vet√©s |

### üü† Sprint 2 - Magas (√úzleti √©rt√©k)

| # | K√∂vetelm√©ny | Referencia | Story Points | Indokl√°s |
|---|-------------|------------|--------------|----------|
| 1.2.4 | Dolgoz√≥i kedvezm√©ny | - | 5 | HR policy |
| 2.2 | Kauci√≥ jegyz≈ëk√∂nyv | - | 3 | Jogi v√©delem |
| 5.4 | H√©tv√©ge √°raz√°s | 03-bergep-folyamat.md | 5 | Bev√©tel optimaliz√°l√°s |
| 6.3 | Szerviz tartoz√©k checklist | 04-szerviz-erd.md | 3 | Min≈ës√©gbiztos√≠t√°s |

### üü° Sprint 3 - K√∂zepes (Haszn√°lhat√≥s√°g)

| # | K√∂vetelm√©ny | Referencia | Story Points | Indokl√°s |
|---|-------------|------------|--------------|----------|
| 1.1.1 | Kiosk m√≥d | 06-egyeb-felhasznalo.md | 5 | UX jav√≠t√°s |
| 3.2-3 | Partner adatok b≈ëv√≠t√©s | 01-ugyfelfelvitel-erd.md | 3 | Adat teljess√©g |
| 5.2-3 | B√©rg√©p tartoz√©kok | 03-bergep-folyamat.md | 5 | Inform√°ci√≥ gazdag√≠t√°s |

---

## Kapcsolat a Dokument√°ci√≥hoz

### √ârintett Diagram Dokumentumok

| Dokumentum | St√°tusz | Friss√≠t√©s sz√ºks√©ges |
|------------|---------|---------------------|
| [01-ugyfelfelvitel-erd.md](../diagram-docs/01-ugyfelfelvitel-erd.md) | üü† PARTIAL | PARTNER, C√âG, B√âRL√âS entit√°sok b≈ëv√≠t√©se |
| [01-ugyfelfelvitel-folyamat.md](../diagram-docs/01-ugyfelfelvitel-folyamat.md) | üü† PARTIAL | Kauci√≥ kezel√©s (MyPos) |
| [01-ugyfelfelvitel-dontesi-fa.md](../diagram-docs/01-ugyfelfelvitel-dontesi-fa.md) | üü† PARTIAL | Fizet√©si m√≥d + jogosults√°g |
| [03-bergep-folyamat.md](../diagram-docs/03-bergep-folyamat.md) | üü† PARTIAL | H√©tv√©ge √°raz√°s, tartoz√©kok |
| [04-szerviz-erd.md](../diagram-docs/04-szerviz-erd.md) | üü† PARTIAL | intake_type, tartoz√©k checklist |
| [06-egyeb-felhasznalo.md](../diagram-docs/06-egyeb-felhasznalo.md) | üü† PARTIAL | Device-based auth |

### √öj Diagramok Sz√ºks√©gesek

1. **MyPos Integr√°ci√≥ Folyamat** - Kauci√≥ k√°rty√°s fizet√©s √©s visszafizet√©s
2. **Kiosk M√≥d Folyamat** - Device-based authentication flow
3. **Kedvezm√©ny Rendszer ERD** - Dolgoz√≥i √©s egy√©b kedvezm√©nyek

---

## K√∂vetkez≈ë L√©p√©sek

1. **Product Owner Review** - Priorit√°sok v√©gleges√≠t√©se
2. **Architect Review** - Technikai megval√≥s√≠that√≥s√°g (s√©mam√≥dos√≠t√°sok)
3. **K√∂nyvel≈ë Egyeztet√©s** - MyPos 2% √ÅFA k√©rd√©sek
4. **Story Lebont√°s** - Sprint planning el≈ëk√©sz√≠t√©s
5. **Diagram Dokument√°ci√≥ Friss√≠t√©s** - √ârintett md f√°jlok update
6. **PRD Friss√≠t√©s** - v1.2 kiad√°s a GAP-ek be√©p√≠t√©s√©vel

---

## V√°ltoz√°snapl√≥

| Verzi√≥ | D√°tum | Szerz≈ë | V√°ltoz√°s |
|--------|-------|--------|----------|
| 1.0 | 2025-12-07 | Mary (Analyst) | Els≈ë kiad√°s - 25 k√∂vetelm√©ny elemz√©se |
| 2.0 | 2025-12-07 | Mary (Analyst) | Diagram dokument√°ci√≥k referencia hozz√°ad√°sa, pontos entit√°s hivatkoz√°sok |
