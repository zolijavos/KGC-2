# 2. Ã‰rtÃ©kesÃ­tÃ©s Folyamat v3.0

## Diagram AlapinformÃ¡ciÃ³k

| TulajdonsÃ¡g | Ã‰rtÃ©k |
|-------------|-------|
| **FÃ¡jlnÃ©v** | `02-ertekesites-folyamat-2025-12-12.excalidraw` |
| **TÃ­pus** | Flowchart (FolyamatÃ¡bra) |
| **Modul** | Ã‰rtÃ©kesÃ­tÃ©s / BevÃ©telezÃ©s |
| **VerziÃ³** | v3.0 |
| **DÃ¡tum** | 2025-12-12 |
| **StÃ¡tusz** | MÃ“DOSÃTOTT |
| **ForrÃ¡s** | fit-gap-analysis-2025-12-12.md |

---

## RÃ©szletes LeÃ­rÃ¡s

Ez a diagram a **bevÃ©telezÃ©s** Ã©s **Ã©rtÃ©kesÃ­tÃ©s** mÃ³dosÃ­tott folyamatait mutatja be. MindkÃ©t folyamat integrÃ¡lva lett a multi-location kÃ©szletkezelÃ©ssel Ã©s a kiadÃ¡si javaslat (R.1/R.2) funkciÃ³val.

---

## BEVÃ‰TELEZÃ‰S Folyamat (MÃ³dosÃ­tott)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                BEVÃ‰TELEZÃ‰S (mÃ³dosÃ­tott) ğŸ”„                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. BeszÃ¡llÃ­tÃ³i szÃ¡mla adatok              â”‚
    â”‚    (szÃ¡m, dÃ¡tum, Ã¶sszeg)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2. TÃ©telek hozzÃ¡adÃ¡sa                     â”‚
    â”‚    (cikk, mennyisÃ©g, Ã¡r)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ†• 3. TÃ¡rhely megadÃ¡s (KÃ–TELEZÅ!)         â”‚
    â”‚    Minden tÃ©telhez:                       â”‚
    â”‚    â†’ Melyik KÃ‰SZLET_HELY-re kerÃ¼l         â”‚
    â”‚    â†’ Dropdown: meglÃ©vÅ‘ tÃ¡rhelyek          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 4. Ã–sszeg ellenÅ‘rzÃ©s                      â”‚
    â”‚    (szÃ¡mÃ­tott vs megadott)                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 5. RÃ¶gzÃ­tÃ©s                               â”‚
    â”‚    â€¢ BEVÃ‰TELEZÃ‰S + TÃ‰TEL rekordok         â”‚
    â”‚ ğŸ†• â€¢ KÃ‰SZLET_HELY.mennyiseg += n          â”‚
    â”‚ ğŸ†• â€¢ KÃ‰SZLET_MOZGÃS (+, tarhely_kod)      â”‚
    â”‚    â€¢ CIKK.keszlet = SUM(kalkulÃ¡lt)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### BevÃ©telezÃ©s SQL MÅ±veletek

```sql
-- 1. KÃ‰SZLET_HELY frissÃ­tÃ©s vagy lÃ©trehozÃ¡s
INSERT INTO KESZLET_HELY (
    tenant_id, cikk_id, tarhely_kod,
    mennyiseg, kiadasi_prioritas, aktiv
)
VALUES (
    @tenant_id, @cikk_id, @tarhely_kod,
    @mennyiseg, @prioritas, TRUE
)
ON CONFLICT (cikk_id, tarhely_kod) DO UPDATE
SET mennyiseg = KESZLET_HELY.mennyiseg + @mennyiseg,
    utolso_frissites = NOW();

-- 2. KÃ‰SZLET_MOZGÃS naplÃ³zÃ¡s
INSERT INTO KESZLET_MOZGAS (
    tenant_id, cikk_id, tipus, mennyiseg,
    tarhely_kod, megjegyzes, datum, rogzito_id
) VALUES (
    @tenant_id, @cikk_id, '+', @mennyiseg,
    @tarhely_kod, 'BevÃ©telezÃ©s', NOW(), @felhasznalo_id
);
```

---

## Ã‰RTÃ‰KESÃTÃ‰S Folyamat (MÃ³dosÃ­tott)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Ã‰RTÃ‰KESÃTÃ‰S (mÃ³dosÃ­tott) ğŸ”„                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. Partner kivÃ¡lasztÃ¡s                    â”‚
    â”‚    (meglÃ©vÅ‘ vagy Ãºj)                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2. Cikk kivÃ¡lasztÃ¡s                       â”‚
    â”‚    (cikkszÃ¡m / vonalkÃ³d)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ†• 3. R.1 KiadÃ¡si Javaslat                â”‚
    â”‚    KÃ‰SZLET_HELY lekÃ©rdezÃ©s                â”‚
    â”‚    prioritÃ¡s szerint:                     â”‚
    â”‚    â†’ TÃ¡blÃ¡zat: hely, menny, prioritÃ¡s     â”‚
    â”‚    â†’ Kiemelt: javasolt helyek             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ†• 4. R.2 MegerÅ‘sÃ­tÃ©s                     â”‚
    â”‚    IGEN â†’ FolytatÃ¡s javaslattal           â”‚
    â”‚    NEM â†’ FelÃ¼lbÃ­rÃ¡lÃ¡s + indoklÃ¡s          â”‚
    â”‚          KIADASI_AUDIT log                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 5. SzÃ¡mla kiÃ¡llÃ­tÃ¡s                       â”‚
    â”‚    (kÃ©szpÃ©nz/kÃ¡rtya/Ã¡tutalÃ¡s)             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### R.1 KiadÃ¡si Javaslat SQL

```sql
-- TÃ¡rhelyek prioritÃ¡s szerint
SELECT
    kh.tarhely_kod,
    kh.mennyiseg,
    kh.kiadasi_prioritas,
    CASE kh.kiadasi_prioritas
        WHEN 1 THEN 'Pult (leggyorsabb)'
        WHEN 2 THEN 'EladÃ³tÃ©r'
        WHEN 3 THEN 'RaktÃ¡r eleje'
        WHEN 4 THEN 'RaktÃ¡r hÃ¡tulja'
        WHEN 5 THEN 'TÃ¡voli (leglassabb)'
    END AS hely_tipus
FROM KESZLET_HELY kh
WHERE kh.cikk_id = @cikk_id
  AND kh.aktiv = TRUE
  AND kh.mennyiseg > 0
ORDER BY kh.kiadasi_prioritas ASC;
```

### R.2 FelÃ¼lbÃ­rÃ¡lÃ¡s Audit

```sql
-- Ha a kezelÅ‘ felÃ¼lbÃ­rÃ¡lja a javaslatot
INSERT INTO KIADASI_AUDIT (
    tenant_id, cikk_id,
    javasolt_tarhely, valasztott_tarhely,
    indoklas_kod, indoklas_szoveg,
    felhasznalo_id, datum
) VALUES (
    @tenant_id, @cikk_id,
    @r1_javaslat, @kezelÅ‘_valasztas,
    @indoklas_kod, @szoveg,
    @felhasznalo_id, NOW()
);
```

---

## KiadÃ¡si PrioritÃ¡s Rendszer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   KIADÃSI PRIORITÃS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1 = Pult (leggyorsabb)                                      â”‚
â”‚     â†’ KÃ¶zvetlen Ã¼gyfÃ©lkiszolgÃ¡lÃ¡s                          â”‚
â”‚                                                             â”‚
â”‚ 2 = EladÃ³tÃ©r                                               â”‚
â”‚     â†’ KÃ¶nnyen hozzÃ¡fÃ©rhetÅ‘ polcok                          â”‚
â”‚                                                             â”‚
â”‚ 3 = RaktÃ¡r eleje                                           â”‚
â”‚     â†’ ElsÅ‘ sorok, gyorsabban elÃ©rhetÅ‘                      â”‚
â”‚                                                             â”‚
â”‚ 4 = RaktÃ¡r hÃ¡tulja                                         â”‚
â”‚     â†’ HÃ¡tsÃ³ polcok, lassabb elÃ©rÃ©s                         â”‚
â”‚                                                             â”‚
â”‚ 5 = TÃ¡voli (leglassabb)                                    â”‚
â”‚     â†’ KÃ¼lsÅ‘ raktÃ¡r, ritkÃ¡n hasznÃ¡lt                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## VÃ¡ltozÃ¡sok Ã–sszefoglalÃ³ja

### BEVÃ‰TELEZÃ‰S VÃ¡ltozÃ¡sok

| LÃ©pÃ©s | KorÃ¡bbi | Ãšj (v3.0) |
|-------|---------|-----------|
| TÃ¡rhely | OpcionÃ¡lis egy mezÅ‘ | KÃ¶telezÅ‘ minden tÃ©telnÃ©l |
| KÃ©szlet | CIKK.keszlet += n | KÃ‰SZLET_HELY.mennyiseg += n |
| NaplÃ³zÃ¡s | AlapvetÅ‘ mozgÃ¡s | + tarhely_kod |

### Ã‰RTÃ‰KESÃTÃ‰S VÃ¡ltozÃ¡sok

| LÃ©pÃ©s | KorÃ¡bbi | Ãšj (v3.0) |
|-------|---------|-----------|
| TÃ¡rhely vÃ¡lasztÃ¡s | Nincs | R.1 automatikus javaslat |
| MegerÅ‘sÃ­tÃ©s | Nincs | R.2 elfogadÃ¡s/felÃ¼lbÃ­rÃ¡lÃ¡s |
| FelÃ¼lbÃ­rÃ¡lÃ¡s | Nincs naplÃ³zÃ¡s | KIADASI_AUDIT + indoklÃ¡s |
| KÃ©szlet | CIKK.keszlet -= n | KÃ‰SZLET_HELY.mennyiseg -= n |

---

## FelÃ¼lbÃ­rÃ¡lÃ¡s IndoklÃ¡s KÃ³dok

| KÃ³d | JelentÃ©s |
|-----|----------|
| `SERULT` | SÃ©rÃ¼lt termÃ©k a javasolt helyen |
| `LELTARELTERES` | EltÃ©rÃ©s a nyilvÃ¡ntartÃ¡sban |
| `UGYFEL_KERES` | ÃœgyfÃ©l specifikus kÃ©rÃ©se |
| `HOZZAFERHETO` | KÃ¶nnyebb hozzÃ¡fÃ©rÃ©s |
| `EGYEB` | Szabad szÃ¶veges indoklÃ¡s |

---

## KapcsolÃ³dÃ³ Dokumentumok

- [02-keszlet-multi-location-erd-2025-12-12.md](02-keszlet-multi-location-erd-2025-12-12.md) - KÃ‰SZLET_HELY entitÃ¡s
- [02-ertekesites-erd-2025-12-12.md](02-ertekesites-erd-2025-12-12.md) - ERD mÃ³dosÃ­tÃ¡sok
- [02-kiadasi-optimalizacio-folyamat-2025-12-12.md](02-kiadasi-optimalizacio-folyamat-2025-12-12.md) - R.1/R.2 rÃ©szletek
- [fit-gap-analysis-2025-12-12.md](../fit-gap-analysis-2025-12-12.md) - KÃ¶vetelmÃ©ny forrÃ¡s
