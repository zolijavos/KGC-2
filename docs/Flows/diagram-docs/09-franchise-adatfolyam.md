# KGC ERP - Multi-Tenant Franchise Adatfolyam

## Diagram AlapinformÃ¡ciÃ³k

| TulajdonsÃ¡g | Ã‰rtÃ©k |
|-------------|-------|
| **FÃ¡jlnÃ©v** | `franchise-adatfolyam.excalidraw` |
| **TÃ­pus** | DFD (Data Flow Diagram) |
| **Modul** | Multi-Tenant ArchitektÃºra |
| **VerziÃ³** | v1.0 |
| **KapcsolÃ³dÃ³ ADR** | ADR-001 (Franchise Multi-Tenancy) |
| **KÃ©szÃ¼lt** | 2025-12-02 |

---

## ÃttekintÃ©s

Ez a diagram a KGC ERP **multi-tenant franchise rendszerÃ©nek adatfolyamÃ¡t** mutatja be. A rendszer egyetlen PostgreSQL adatbÃ¡zist hasznÃ¡l `tenant_id` alapÃº Row Level Security (RLS) izolÃ¡ciÃ³val.

### FÅ‘bb Elemek

- **1 KÃ¶zponti tenant** (KisgÃ©pcentrum)
- **N Franchise tenant** (kÃ¼lÃ¶nbÃ¶zÅ‘ csomagokkal)
- **Single Database** (PostgreSQL + RLS)
- **KÃ©szlet SzinkronizÃ¡ciÃ³** (1-5 perc)
- **Webshop IntegrÃ¡ciÃ³** (orszÃ¡gos kÃ©szlet)

---

## 1. Tenant Hierarchia

### 1.1 KÃ¶zpont (Central)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ”µ KÃ–ZPONT (Central)                      â”‚
â”‚                  tenant_type: 'central'                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  HozzÃ¡fÃ©rÃ©s:                                                 â”‚
â”‚  âœ… Teljes rendszer (SUPER_ADMIN szerepkÃ¶rrel)              â”‚
â”‚  âœ… OrszÃ¡gos statisztikÃ¡k (aggregÃ¡lt)                       â”‚
â”‚  âœ… Franchise partner kezelÃ©s (lÃ©trehozÃ¡s, tÃ¶rlÃ©s)          â”‚
â”‚  âœ… Csomag hozzÃ¡rendelÃ©s                                    â”‚
â”‚  âœ… KÃ¶zponti szerviz szolgÃ¡ltatÃ¡s                           â”‚
â”‚                                                              â”‚
â”‚  KorlÃ¡tozÃ¡s:                                                 â”‚
â”‚  âŒ Egyedi franchise pÃ©nzÃ¼gyi rÃ©szletek                     â”‚
â”‚     (csak aggregÃ¡lt statisztikÃ¡k lÃ¡thatÃ³k)                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Franchise Csomagok

| Csomag | NÃ©v | Modulok | CÃ©lcsoport |
|--------|-----|---------|------------|
| **komplett** | Komplett | BÃ©rlÃ©s + Szerviz + Ã‰rtÃ©kesÃ­tÃ©s | Teljes szolgÃ¡ltatÃ¡s |
| **kolcsonzo** | KÃ¶lcsÃ¶nzÅ‘ | BÃ©rlÃ©s + Ã‰rtÃ©kesÃ­tÃ©s | Csak bÃ©rlÃ©s |
| **szerviz** | Szerviz | Szerviz + Ã‰rtÃ©kesÃ­tÃ©s | Csak javÃ­tÃ¡s |

---

## 2. Franchise Tenant TÃ­pusok

### 2.1 Franchise A - Komplett Csomag

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŸ¢ FRANCHISE A (Komplett)                 â”‚
â”‚                  package: 'komplett'                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  HozzÃ¡fÃ©rÃ©s:                                                 â”‚
â”‚  âœ… SajÃ¡t Ã¼gyfelek Ã©s bÃ©rlÃ©sek                              â”‚
â”‚  âœ… SajÃ¡t kÃ©szlet kezelÃ©s                                   â”‚
â”‚  âœ… Teljes pÃ©nzÃ¼gyi mÅ±veletek                               â”‚
â”‚  âœ… Szerviz modul (munkalapok, alkatrÃ©szek)                 â”‚
â”‚  âœ… OrszÃ¡gos kÃ©szlet lÃ¡thatÃ³sÃ¡g (csak olvasÃ¡s)              â”‚
â”‚                                                              â”‚
â”‚  KorlÃ¡tozÃ¡s:                                                 â”‚
â”‚  âŒ MÃ¡s franchise adatai (Ã¼gyfelek, pÃ©nzÃ¼gyek)              â”‚
â”‚  âŒ KÃ¶zponti statisztikÃ¡k                                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Franchise B - KÃ¶lcsÃ¶nzÅ‘ Csomag

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŸ  FRANCHISE B (KÃ¶lcsÃ¶nzÅ‘)                â”‚
â”‚                  package: 'kolcsonzo'                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  HozzÃ¡fÃ©rÃ©s:                                                 â”‚
â”‚  âœ… SajÃ¡t Ã¼gyfelek Ã©s bÃ©rlÃ©sek                              â”‚
â”‚  âœ… SajÃ¡t kÃ©szlet kezelÃ©s                                   â”‚
â”‚  âœ… Teljes pÃ©nzÃ¼gyi mÅ±veletek                               â”‚
â”‚  âœ… OrszÃ¡gos kÃ©szlet lÃ¡thatÃ³sÃ¡g (csak olvasÃ¡s)              â”‚
â”‚                                                              â”‚
â”‚  KorlÃ¡tozÃ¡s:                                                 â”‚
â”‚  âŒ Szerviz modul (nincs munkalap kezelÃ©s)                  â”‚
â”‚  âŒ MÃ¡s franchise adatai                                    â”‚
â”‚                                                              â”‚
â”‚  MegjegyzÃ©s:                                                 â”‚
â”‚  Ha szerviz kell â†’ KÃ¶zponti szervizbe kÃ¼ldhetÅ‘ a gÃ©p        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Franchise C - Szerviz Csomag

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŸ£ FRANCHISE C (Szerviz)                  â”‚
â”‚                  package: 'szerviz'                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  HozzÃ¡fÃ©rÃ©s:                                                 â”‚
â”‚  âœ… SajÃ¡t Ã¼gyfelek                                          â”‚
â”‚  âœ… Teljes pÃ©nzÃ¼gyi mÅ±veletek                               â”‚
â”‚  âœ… Szerviz modul (teljes funkcionalitÃ¡s)                   â”‚
â”‚  âœ… KÃ¶zponti szerviz kÃ¼ldÃ©s/fogadÃ¡s                         â”‚
â”‚  âœ… AlkatrÃ©sz Ã©rtÃ©kesÃ­tÃ©s                                   â”‚
â”‚                                                              â”‚
â”‚  KorlÃ¡tozÃ¡s:                                                 â”‚
â”‚  âŒ BÃ©rlÃ©s modul (nincs bÃ©rgÃ©p kezelÃ©s)                     â”‚
â”‚  âŒ MÃ¡s franchise adatai                                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. AdatbÃ¡zis IzolÃ¡ciÃ³

### 3.1 Single Database + tenant_id

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ—„ï¸ PostgreSQL                             â”‚
â”‚                    (Single Database)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 ROW LEVEL SECURITY (RLS)              â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  CREATE POLICY tenant_isolation ON partners           â”‚  â”‚
â”‚  â”‚  USING (tenant_id = current_setting('app.tenant_id')) â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  -- Automatikus szÅ±rÃ©s minden lekÃ©rdezÃ©snÃ©l           â”‚  â”‚
â”‚  â”‚  -- Nincs "elfelejtett WHERE" problÃ©ma                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  TÃ¡blÃ¡k tenant_id oszloppal:                                â”‚
â”‚  â€¢ partners (Ã¼gyfelek)                                      â”‚
â”‚  â€¢ rentals (bÃ©rlÃ©sek)                                       â”‚
â”‚  â€¢ products (cikkek)                                        â”‚
â”‚  â€¢ inventory (kÃ©szlet)                                      â”‚
â”‚  â€¢ service_orders (munkalapok)                              â”‚
â”‚  â€¢ invoices (szÃ¡mlÃ¡k)                                       â”‚
â”‚  â€¢ ... (minden Ã¼zleti tÃ¡bla)                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Tenant TÃ¡bla StruktÃºra

```sql
CREATE TABLE tenants (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    type ENUM('central', 'franchise') NOT NULL,
    package ENUM('kolcsonzo', 'szerviz', 'komplett') NULL,
    -- 8. rÃ©sz bÅ‘vÃ­tÃ©s: Holding kapcsolat
    holding_id UUID REFERENCES holding(holding_id),
    is_subsidiary BOOLEAN DEFAULT FALSE,
    -- StÃ¡tusz
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- PÃ©lda adatok
INSERT INTO tenants VALUES
    ('uuid-1', 'KisgÃ©pcentrum KÃ¶zpont', 'central', NULL),
    ('uuid-2', 'KGC GyÅ‘r', 'franchise', 'komplett'),
    ('uuid-3', 'KGC Debrecen', 'franchise', 'kolcsonzo'),
    ('uuid-4', 'Szerviz Partner Kft.', 'franchise', 'szerviz');
```

---

## 4. Adatfolyam Diagram

### 4.1 Teljes Adatfolyam

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚      ğŸ”µ KÃ–ZPONT             â”‚
                         â”‚   (tenant_type: 'central')  â”‚
                         â”‚                             â”‚
                         â”‚  â€¢ Franchise kezelÃ©s        â”‚
                         â”‚  â€¢ AggregÃ¡lt statisztikÃ¡k   â”‚
                         â”‚  â€¢ KÃ¶zponti szerviz         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                 â”‚                 â”‚
                      â–¼                 â–¼                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ğŸŸ¢ Franchise A â”‚ â”‚  ğŸŸ  Franchise B â”‚ â”‚  ğŸŸ£ Franchise C â”‚
            â”‚    (Komplett)   â”‚ â”‚   (KÃ¶lcsÃ¶nzÅ‘)   â”‚ â”‚    (Szerviz)    â”‚
            â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
            â”‚ â€¢ BÃ©rlÃ©s âœ…     â”‚ â”‚ â€¢ BÃ©rlÃ©s âœ…     â”‚ â”‚ â€¢ BÃ©rlÃ©s âŒ     â”‚
            â”‚ â€¢ Szerviz âœ…    â”‚ â”‚ â€¢ Szerviz âŒ    â”‚ â”‚ â€¢ Szerviz âœ…    â”‚
            â”‚ â€¢ Ã‰rtÃ©kesÃ­tÃ©s âœ…â”‚ â”‚ â€¢ Ã‰rtÃ©kesÃ­tÃ©s âœ…â”‚ â”‚ â€¢ Ã‰rtÃ©kesÃ­tÃ©s âœ…â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                   â”‚                   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           ğŸ—„ï¸ PostgreSQL                 â”‚
                    â”‚                                         â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚   â”‚     Row Level Security (RLS)    â”‚   â”‚
                    â”‚   â”‚  WHERE tenant_id = current()    â”‚   â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚                                         â”‚
                    â”‚   Automatikus tenant izolÃ¡ciÃ³           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â–¼                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  KÃ©szlet Sync   â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚    Webshop      â”‚
                â”‚   (1-5 perc)    â”‚       â”‚ (OrszÃ¡gos R/O)  â”‚
                â”‚                 â”‚       â”‚                 â”‚
                â”‚ Event-driven    â”‚       â”‚ VevÅ‘ lÃ¡tja:     â”‚
                â”‚ Message Queue   â”‚       â”‚ "Ã‰rd: 3 db"     â”‚
                â”‚                 â”‚       â”‚ "GyÅ‘r: 1 db"    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. KÃ©szlet SzinkronizÃ¡ciÃ³

### 5.1 MÅ±kÃ¶dÃ©s

| LÃ©pÃ©s | LeÃ­rÃ¡s |
|-------|--------|
| 1 | KÃ©szlet vÃ¡ltozÃ¡s tÃ¶rtÃ©nik (eladÃ¡s, bevÃ©telezÃ©s) |
| 2 | Event publikÃ¡lÃ¡s Message Queue-ba |
| 3 | KÃ¶zponti aggregÃ¡tor feldolgozza |
| 4 | Cache frissÃ­tÃ©s (1-5 perc TTL) |
| 5 | Webshop lekÃ©rdezi a cache-t |

### 5.2 OrszÃ¡gos KÃ©szlet MegjelenÃ­tÃ©s

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŒ WEBSHOP                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  KeresÃ©s: "Makita Ã¼tvefÃºrÃ³"                                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ KÃ©szleten:                                            â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  ğŸ“ Ã‰rd (kÃ¶zpont):     3 db    [FOGLALÃS]            â”‚  â”‚
â”‚  â”‚  ğŸ“ GyÅ‘r:              1 db    [FOGLALÃS]            â”‚  â”‚
â”‚  â”‚  ğŸ“ Debrecen:          2 db    [FOGLALÃS]            â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  UtoljÃ¡ra frissÃ­tve: 2 perce                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. AdatvÃ©delmi SzabÃ¡lyok

### 6.1 HozzÃ¡fÃ©rÃ©si MÃ¡trix

| Adat tÃ­pus | SUPER_ADMIN | CENTRAL_ADMIN | FRANCHISE_ADMIN |
|------------|-------------|---------------|-----------------|
| SajÃ¡t pÃ©nzÃ¼gy | âœ… | âŒ | âœ… (csak sajÃ¡t) |
| MÃ¡s franchise pÃ©nzÃ¼gy | âœ… | âŒ | âŒ |
| OrszÃ¡gos statisztika | âœ… | âœ… | âŒ |
| SajÃ¡t statisztika | âœ… | âœ… | âœ… |
| OrszÃ¡gos kÃ©szlet | âœ… | âœ… | âœ… (olvasÃ¡s) |
| Franchise lÃ©trehozÃ¡s | âœ… | âœ… | âŒ |
| Adatexport | âœ… | âŒ | âŒ |

### 6.2 Kritikus SzabÃ¡lyok

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    âš ï¸ FONTOS SZABÃLYOK                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Franchise SOHA nem lÃ¡that mÃ¡s franchise adatÃ¡t          â”‚
â”‚     â†’ RLS automatikusan kikÃ©nyszerÃ­ti                       â”‚
â”‚                                                              â”‚
â”‚  2. KÃ¶zpont NEM lÃ¡t bele franchise pÃ©nzÃ¼gyekbe              â”‚
â”‚     â†’ Csak aggregÃ¡lt statisztikÃ¡k (darabszÃ¡m, Ã¶sszeg)       â”‚
â”‚                                                              â”‚
â”‚  3. Adatexport CSAK SUPER_ADMIN szÃ¡mÃ¡ra                     â”‚
â”‚     â†’ VÃ©delem az adatlopÃ¡s ellen                            â”‚
â”‚                                                              â”‚
â”‚  4. KÃ©szlet: minden franchise lÃ¡tja orszÃ¡gosan              â”‚
â”‚     â†’ De csak sajÃ¡t kÃ©szletet mÃ³dosÃ­thatja                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Holding StruktÃºra (8. rÃ©sz)

### 7.1 AnyavÃ¡llalat - LeÃ¡nyvÃ¡llalat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KGC HOLDING KFT.                          â”‚
â”‚                    (AnyavÃ¡llalat)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚                                  â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚                    â”‚                    â”‚            â”‚
â”‚      â–¼                    â–¼                    â–¼            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ KGC Ã‰rd Kft â”‚    â”‚ KGC GyÅ‘r Kftâ”‚    â”‚KGC Debrecen â”‚      â”‚
â”‚ â”‚  (KÃ¶zpont)  â”‚    â”‚             â”‚    â”‚    Kft      â”‚      â”‚
â”‚ â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚
â”‚ â”‚ tenant_id:1 â”‚    â”‚ tenant_id:2 â”‚    â”‚ tenant_id:3 â”‚      â”‚
â”‚ â”‚ is_subsid:T â”‚    â”‚ is_subsid:T â”‚    â”‚ is_subsid:T â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Holding ElÅ‘nyÃ¶k

| ElÅ‘ny | LeÃ­rÃ¡s |
|-------|--------|
| **AdÃ³mentes osztalÃ©k** | EU anyavÃ¡llalat â†’ leÃ¡nyvÃ¡llalat 0% |
| **KonszolidÃ¡lt beszÃ¡molÃ³k** | EgysÃ©ges csoport riportok |
| **KockÃ¡zat elkÃ¼lÃ¶nÃ­tÃ©s** | RegionÃ¡lis tÃ¡rsasÃ¡gok Ã¶nÃ¡llÃ³ felelÅ‘ssÃ©ge |
| **SkÃ¡lÃ¡zhatÃ³ terjeszkedÃ©s** | Ãšj rÃ©giÃ³ = Ãºj leÃ¡nyvÃ¡llalat |

---

## KapcsolÃ³dÃ³ Dokumentumok

| Dokumentum | Kapcsolat |
|------------|-----------|
| [ADR-001](../architecture/ADR-001-franchise-multitenancy.md) | RÃ©szletes dÃ¶ntÃ©sek |
| [kgc-system-architecture.md](kgc-system-architecture.md) | Teljes rendszer |
| [rbac-hierarchia.md](rbac-hierarchia.md) | JogosultsÃ¡gok |
| [08-holding-struktura.md](../Flows/diagram-docs/08-holding-struktura.md) | Holding rÃ©szletek |

---

*DokumentÃ¡ciÃ³ kÃ©szÃ¼lt: 2025-12-04*
*KapcsolÃ³dÃ³ diagram: franchise-adatfolyam.excalidraw*
